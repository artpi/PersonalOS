name: Build PersonalOS Plugin
description: Install dependencies, build assets, and create the plugin ZIP.
inputs:
  node-version:
    description: Node.js version to use.
    required: false
    default: '20'
  php-version:
    description: PHP version to use.
    required: false
    default: '8.2'
  composer-no-dev:
    description: Whether to install Composer dependencies without dev packages.
    required: false
    default: 'true'
  zip-path:
    description: Expected plugin ZIP path produced by build.
    required: false
    default: wp-personal-os.zip
outputs:
  zip-path:
    description: Path to the generated plugin ZIP file.
    value: ${{ steps.zip-path.outputs.path }}
runs:
  using: composite
  steps:
    - name: Setup dependencies
      uses: ./.github/actions/setup-deps
      with:
        node-version: ${{ inputs.node-version }}
        php-version: ${{ inputs.php-version }}
        composer-no-dev: ${{ inputs.composer-no-dev }}

    - name: Build plugin assets
      run: npm run build
      shell: bash

    - name: Create plugin ZIP
      run: npx --yes @wordpress/scripts@30.7.0 plugin-zip
      shell: bash

    - id: zip-path
      run: echo "path=${{ inputs.zip-path }}" >> "$GITHUB_OUTPUT"
      shell: bash
